<!doctype html>
<html ng-app="profilesApp" lang="fr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <!-- Angular -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0/angular-sanitize.min.js"></script>
    <script src="https://code.angularjs.org/1.3.0/i18n/angular-locale_fr-fr.js"></script>

    <!-- UI Bootstrap -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.11.0/ui-bootstrap.min.js"></script>

    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
    <script src="js/zoumprofiler.js"></script>

    <title>ZoumProfiler</title>
</head>


<body>

<div class="banner">
    <a href="#">En développement</a>
</div>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">ZoumProfiler</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <!--<li><a href="#">Dashboard</a></li>-->
                <!--<li><a href="#">Settings</a></li>-->
                <!--<li><a href="#">Profile</a></li>-->
                <!--<li><a href="#">Help</a></li>-->
            </ul>
            <!--<form class="navbar-form navbar-right">-->
            <!--<input type="text" class="form-control" placeholder="Search...">-->
            <!--</form>-->
        </div>
    </div>
</div>

<div class="container-fluid" ng-controller="ProfilesController">

    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li ng-repeat="p in profiles | orderBy:['name','profile']"
                    ng-class="{true:'active', false:''}[profile == p]">

                    <input type="checkbox" value="" ng-model="compare.map[p.id]" />

                    <a href="#" ng-click="selectProfile(p)">
                        {{p.name}} <span ng-if="p.profile" class="profile">({{p.profile}})</span>
                    </a>

                    <div class="buttons">
                        <button type="button" class="btn btn-xs btn-primary" ng-click="copyProfile(p)" title="Dupliquer">
                            <span class="glyphicon glyphicon-share"></span>
                        </button>

                        <button type="button" class="btn btn-xs btn-danger" ng-click="deleteProfile(p)" title="Supprimer">
                            <span class="glyphicon glyphicon-remove"></span>
                        </button>
                    </div>

                </li>
            </ul>

            <button type="button" class="btn btn-sm btn-primary" ng-disabled="getCompareIds().length < 2" ng-click="compareProfiles()">
                <span class="glyphicon glyphicon-stats"></span> Comparer les profils
            </button>

            <br/>

            <button type="button" class="btn btn-sm btn-primary" ng-click="addProfile()">
                <span class="glyphicon glyphicon-plus"></span> Ajouter un profil
            </button>

            <button type="button" class="btn btn-sm btn-primary" ng-click="startImport()">
                <span class="glyphicon glyphicon-import"></span> Importer un profil
            </button>

        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">

            <div class="alert alert-success" ng-if="successMessage" ng-bind-html="successMessage"></div>
            <div ng-repeat="errorMessage in errorMessages" class="alert alert-danger">{{errorMessage}}</div>
            <div class="alert alert-warning">Attention, les profils que vous allez créer ne seront sauvegardés que quand
                vous cliquerez sur "Enregistrer le profil". D'autre part, ils sont stockés (pour l'instant) dans votre
                navigateur uniquement, ce qui signifie que vous ne les retrouverez pas si vous utilisez un autre
                navigateur.</div>
            <div ng-if="computed.totalPi > config.maxPi" class="alert alert-danger">Ce profil dépasse la limite de <b>{{config.maxPi}}
                PI</b>. Il vous manque <b>{{computed.totalPi - config.maxPi}} PI</b>.</div>

            <form ng-if="import.show" class="form-horizontal" role="form">
                <div class="alert alert-info">Vous pouvez coller dans la zone ci-dessous le JSON d'un profil.</div>
                <div class="form-group">
                    <label for="importJson" class="col-sm-2 control-label">Profil au format JSON</label>

                    <div class="col-sm-10">
                        <textarea ng-model="import.json" class="form-control" id="importJson"></textarea>
                    </div>

                    <button type="button" class="btn btn-success" ng-click="importProfile()">
                        <span class="glyphicon glyphicon-import"></span> Importer le profil
                    </button>

                    <pre class="infodev">{{import.json}}</pre>
                </div>
            </form>

            <form ng-if="profile" class="form-horizontal" role="form">

                <div class="row actionbar">
                    <button type="button" class="btn btn-sm btn-success" ng-click="saveProfile()">
                        <span class="glyphicon glyphicon-save"></span> Enregistrer le profil
                    </button>

                    <button type="button" class="btn btn-sm btn-primary" ng-click="copyProfile(profile)">
                        <span class="glyphicon glyphicon-share"></span> Copier le profil
                    </button>

                    <button type="button" class="btn btn-sm btn-danger" ng-click="deleteProfile(profile)">
                        <span class="glyphicon glyphicon-remove"></span> Supprimer le profil
                    </button>
                </div>

                <div class="form-group">
                    <label for="name" class="col-sm-2 control-label">Trõll</label>

                    <div class="col-sm-2">
                        <input type="text" class="form-control" id="name" ng-model="profile.name">
                    </div>

                    <label for="name" class="col-sm-1 control-label">Profil</label>

                    <div class="col-sm-2">
                        <input type="text" class="form-control" id="profile" ng-model="profile.profile">
                    </div>

                    <label class="col-sm-4 control-label">
                        <span ng-class="{true:'error', false:''}[computed.totalPi > config.maxPi]">{{computed.totalPi}} PI</span>
                        (Niveau >= {{computed.level}}) - reste {{config.maxPi - computed.totalPi}} PI
                    </label>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">Race</label>

                    <div class="col-sm-10">
                        <span ng-repeat="race in races">
                            <input type="radio" ng-model="profile.race" name="race" value="{{race}}" ng-required="true"
                                   ng-change="raceChanged()"/>
                            {{race}}
                        </span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">Caractéristiques ({{computed.piCaracts}} PI - {{computed.percentCaracts | number:2}}%)</label>

                    <div class="col-sm-10">
                        <table class="table table-striped table-hover table-condensed">
                            <thead>
                                <tr>
                                    <td>Nom</td>
                                    <td>Valeur</td>
                                    <td>Bonus</td>
                                    <td>Moyenne</td>
                                    <td>Nombre d'améliorations</td>
                                    <td>Investi</td>
                                    <td>Coût de la prochaine amélioration</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="carac in caracs">
                                    <td>{{carac.id}}</td>
                                    <td>
                                        <input type="number" class="carac" ng-model="profile.caracs[carac.id]" size="2"
                                               min="{{carac.min}}" max="{{carac.max}}" step="{{carac.step}}"
                                               ng-change="refreshComputed()"/>
                                        <span ng-if="carac.type == 'D3' || carac.type == 'D6'">{{carac.type}}</span>
                                    </td>
                                    <td>
                                        <input ng-if="carac.id != 'TOUR'" type="number" class="carac" ng-model="profile.bp[carac.id]"
                                               ng-disabled="carac.id == 'PV' || carac.id == 'VUE'"/>
                                        <input ng-if="carac.id != 'TOUR'" type="number" class="carac" ng-model="profile.bm[carac.id]"/>
                                    </td>
                                    <td>
                                        <span ng-if="carac.type == 'T'">{{profile.caracs[carac.id] | duration}}</span>
                                        <span ng-if="carac.type == 'D1'">{{profile.caracs[carac.id] + profile.bp[carac.id] + profile.bm[carac.id]}}</span>
                                        <span ng-if="carac.type == 'D3'">{{profile.caracs[carac.id] * 2 + profile.bp[carac.id] + profile.bm[carac.id]}}<span ng-if="carac.id == 'DEG'">/{{degCritique(profile, profile.caracs[carac.id])}}</span></span>
                                        <span ng-if="carac.type == 'D6'">{{profile.caracs[carac.id] * 3.5 + profile.bp[carac.id] + profile.bm[carac.id]}}</span>
                                    </td>
                                    <td>{{computed.amelioCount[carac.id]}}</td>
                                    <td>{{computed.invested[carac.id]}} PI ({{computed.percentInvested[carac.id] | number:2}}%)</td>
                                    <td ng-class="{true:'error', false:''}[(computed.totalPi + computed.nextCosts[carac.id]) > config.maxPi]">{{computed.nextCosts[carac.id]}} PI</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="form-group comp-box">
                    <label class="col-sm-2 control-label">Aptitude au combat</label>

                    <div class="col-sm-10">
                        <table class="table table-striped table-hover table-condensed">
                            <thead>
                                <tr>
                                    <td></td>
                                    <td>Attaque</td>
                                    <td>Dégats</td>
                                    <td>Dégats résistés</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="combatApt in computed.combat|orderBy:'name'">
                                    <td>{{combatApt.name}}</td>
                                    <td style="font-style: italic; color: #aaaaaa;">To be computed...</td>
                                    <td style="font-style: italic; color: #aaaaaa;">To be computed...</td>
                                    <td style="font-style: italic; color: #aaaaaa;">To be computed...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="form-group comp-box">
                    <label class="col-sm-2 control-label">Compétences ({{computed.piComps}} PI - {{computed.percentComps | number:2}}%)</label>

                    <div class="col-sm-3">
                        <label>Combat</label>
                        <div class="checkbox" ng-repeat="comp in compsByType['Combat']|orderBy:'name'">
                            <label>
                                <input type="checkbox" value="" ng-model="profile.comps[comp.id]" ng-change="checkCompLevel(comp)"/>
                                {{comp.name}} (<b>{{comp.cost}} PI</b>)
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label>Connaissance</label>
                        <div class="checkbox" ng-repeat="comp in compsByType['Connaissance']|orderBy:'name'">
                            <label>
                                <input type="checkbox" value="" ng-model="profile.comps[comp.id]" ng-change="checkCompLevel(comp)"/>
                                {{comp.name}} (<b>{{comp.cost}} PI</b>)
                            </label>
                        </div>
                        <label>Utile</label>
                        <div class="checkbox" ng-repeat="comp in compsByType['Utile']|orderBy:'name'">
                            <label>
                                <input type="checkbox" value="" ng-model="profile.comps[comp.id]" ng-change="checkCompLevel(comp)"/>
                                {{comp.name}} (<b>{{comp.cost}} PI</b>)
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label>Déplacement</label>
                        <div class="checkbox" ng-repeat="comp in compsByType['Déplacement']|orderBy:'name'">
                            <label>
                                <input type="checkbox" value="" ng-model="profile.comps[comp.id]" ng-change="checkCompLevel(comp)"/>
                                {{comp.name}} (<b>{{comp.cost}} PI</b>)
                            </label>
                        </div>
                        <label>Artisanat</label>
                        <div class="checkbox" ng-repeat="comp in compsByType['Artisanat']|orderBy:'name'">
                            <label>
                                <input type="checkbox" value="" ng-model="profile.comps[comp.id]" ng-change="checkCompLevel(comp)"/>
                                {{comp.name}} (<b>{{comp.cost}} PI</b>)
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row actionbar">
                    <button type="button" class="btn btn-sm btn-success" ng-click="saveProfile()">
                        <span class="glyphicon glyphicon-save"></span> Enregistrer le profil
                    </button>

                    <button type="button" class="btn btn-sm btn-primary" ng-click="copyProfile(profile)">
                        <span class="glyphicon glyphicon-share"></span> Copier le profil
                    </button>

                    <button type="button" class="btn btn-sm btn-danger" ng-click="deleteProfile(profile)">
                        <span class="glyphicon glyphicon-remove"></span> Supprimer le profil
                    </button>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">Profil au format JSON</label>

                    <div class="col-sm-10">
                        <pre class="infodev">{{profile}}</pre>
                    </div>
                </div>
    
            </form>

            <form ng-if="compare.show" class="form-horizontal" role="form">

                <table class="table table-striped table-hover table-condensed compare">
                    <tbody>
                        <tr>
                            <td></td>
                            <th colspan="{{compare.profiles.length}}" class="title">Caractéristiques</th>
                        </tr>
                        <tr>
                            <td></td>
                            <th ng-repeat="p in compare.profiles">{{p.name}} ({{p.profile}})</th>
                        </tr>
                        <tr ng-repeat="carac in caracs">
                            <td>{{carac.id}}</td>
                            <td ng-repeat="p in compare.profiles"> {{ p.caracs[carac.id] }}
                                <span ng-if="carac.type == 'D3' || carac.type == 'D6'">{{carac.type}}</span>
                                (
                                <span ng-if="carac.type == 'T'">{{p.caracs[carac.id] | duration}}</span>
                                <span ng-if="carac.type == 'D1'">{{p.caracs[carac.id]}}</span>
                                <span ng-if="carac.type == 'D3'">{{p.caracs[carac.id] * 2}}<span ng-if="carac.id == 'DEG'">/{{degCritique(p, p.caracs[carac.id])}}</span></span>
                                <span ng-if="carac.type == 'D6'">{{p.caracs[carac.id] * 3.5}}</span>
                                )
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <th colspan="{{compare.profiles.length}}" class="title">Compétences</th>
                        </tr>
                        <tr>
                            <td></td>
                            <th ng-repeat="p in compare.profiles">{{p.name}} ({{p.profile}})</th>
                        </tr>
                        <tr ng-repeat="comp in compare.comps|orderBy:'name'">
                            <td></td>
                            <td ng-repeat="p in compare.profiles">
                                <span ng-if="p.comps[comp.id] === true">{{ comp.name }}</span>
                            </td>
                        </tr>
                    </tbody>
                </table>

            </form>

        </div>

    </div>

    <!--hr/>
    <h5 class="infodev">Infos pour les développeurs :</h5>
    <pre class="infodev">Vote en cours : { {vote} }</pre>
    <pre class="infodev">Votes : { {votes} }</pre-->

</div>
<!-- /.container -->

</body>

<script>
    $(function () {
        $('input[type=checkbox]').tooltip();
    });
</script>

</html>
